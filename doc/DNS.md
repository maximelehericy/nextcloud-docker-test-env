# DNS

There are two ways to handle the DNS for the services you will run on your local environment:
- use the `/etc/hosts` file
- use a local DNS resolver such as `dnsmasq`

The `/etc/hosts` file is largely described across this repository, but with time, I found a better approach that avoids needing to edit the `/etc/hosts` file for every new service I locally host: the **NetworkManager dnsmasq plugin**. The following works for all Linux users.

Most of the below comes from -> https://fedoramagazine.org/using-the-networkmanagers-dnsmasq-plugin/

For the present use-case, fewer files need to be added/modified:

```sh
# enable dnsmasq plugin

cat <<EOF | sudo tee /etc/NetworkManager/conf.d/00-use-dnsmasq.conf

# /etc/NetworkManager/conf.d/00-use-dnsmasq.conf
#
# This enabled the dnsmasq plugin.
[main]
dns=dnsmasq
EOF

# set DNS resolution rules for your local environment

cat << EOF | sudo tee /etc/NetworkManager/dnsmasq.d/01-localDNS.conf

# /etc/NetworkManager/dnsmasq.d/01-localDNS.conf
# This file sets up the local lablab domain and 
# defines some aliases and a wildcard.
local=/local.YOURDOMAIN.org/

# The below defines a Wildcard DNS Entry, poiting to the IP of the docker reverse proxy
address=/.local.YOURDOMAIN.org/172.19.0.1

# Below you can also define other names:
# address=/openshift.local.YOURDOMAIN.org/192.168.101.120
# address=/openshift-int.local.YOURDOMAIN.org/192.168.101.120

EOF

# configure DNS masqplugin to also read in /etc/hosts
cat << EOF | sudo tee /etc/NetworkManager/dnsmasq.d/02-add-hosts.conf

# /etc/NetworkManager/dnsmasq.d/02-add-hosts.conf
# By default, the plugin does not read from /etc/hosts.  
# This forces the plugin to slurp in the file.
#
# If you didn't want to write to the /etc/hosts file.  This could
# be pointed to another file.
#
addn-hosts=/etc/hosts
EOF

# disable systemd-resolved (default DNS resolver) to avoid conflicts
sudo systemctl disable systemd-resolved systemd-resolved-varlink.socket systemd-resolved-monitor.socket


# restart the NetworkManager
systemctl restart NetworkManager

```

And check the changes. According to the documentation above

`sudo cat /etc/resolv.conf` should show:

```
# Generated by NetworkManager
nameserver 127.0.0.1
```

But it wasn't the case for me. I simply had to reboot, and then I could access service at `*.local.YOURDOMAIN.org`, despite `sudo cat /etc/resolv.conf` giving nothing (empty file).


